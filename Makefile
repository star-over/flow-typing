# ==============================================================================
# Makefile for FlowTyping
#
# –≠—Ç–æ—Ç —Ñ–∞–π–ª —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –∏ —É–ø—Ä–æ—â–∞–µ—Ç –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞.
# ==============================================================================

# SHELL - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–±–æ–ª–æ—á–∫—É –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥.
# –ò—Å–ø–æ–ª—å–∑—É–µ–º bash –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
SHELL := /bin/bash

# .PHONY - –æ–±—ä—è–≤–ª—è–µ—Ç —Ü–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å —Ñ–∞–π–ª–∞–º–∏.
# –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –æ–¥–Ω–æ–∏–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –∏ —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
.PHONY: all help install clean dev build start test lint lint-fix type-check storybook build-storybook check-all

# Default - —Ü–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `make` –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
all: help


# ==============================================================================
# HELP
# ==============================================================================

# help - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º.
# –°–∏–º–≤–æ–ª @ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∞–≤–ª—è–µ—Ç –≤—ã–≤–æ–¥ —Å–∞–º–æ–π –∫–æ–º–∞–Ω–¥—ã.
help:
	@echo "------------------------------------------------------------------"
	@echo " ‚ú® FlowTyping Makefile ‚ú®"
	@echo "------------------------------------------------------------------"
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo ""
	@echo "  make install          - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ (npm install)"
	@echo "  make clean              - –£–¥–∞–ª–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
	@echo ""
	@echo "  make dev              - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Next.js)"
	@echo "  make build            - –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"
	@echo "  make start            - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–±–æ—Ä–∫—É"
	@echo ""
	@echo "  make test             - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (Vitest)"
	@echo "  make lint             - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é –ª–∏–Ω—Ç–µ—Ä–∞ (ESLint)"
	@echo "  make lint-fix         - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞"
	@echo "  make type-check       - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã TypeScript (tsc)"
	@echo "  make check-all        - –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (lint, type-check, test)"
	@echo ""
	@echo "  make storybook        - –ó–∞–ø—É—Å—Ç–∏—Ç—å Storybook –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"
	@echo "  make build-storybook  - –°–æ–±—Ä–∞—Ç—å Storybook –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏"
	@echo "------------------------------------------------------------------"


# ==============================================================================
# PROJECT SETUP
# ==============================================================================

# install - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ npm.
# node_modules —è–≤–ª—è–µ—Ç—Å—è "—Ñ–∞–π–ª–æ–º-–º–∞—Ä–∫–µ—Ä–æ–º". –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏
# —ç—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
node_modules: package.json package-lock.json
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	npm install
	@touch node_modules # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª-–º–∞—Ä–∫–µ—Ä

install: node_modules


# clean - —É–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
	rm -rf .next
	rm -rf node_modules
	rm -rf coverage
	rm -rf storybook-static


# ==============================================================================
# DEVELOPMENT & PRODUCTION
# ==============================================================================

# dev - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Next.js.
dev: install
	@echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
	npx next dev

# build - —Å–æ–±–∏—Ä–∞–µ—Ç production-–≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
build: install
	@echo "üèóÔ∏è  –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
	npx next build

# start - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω–æ–µ production-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
start: build
	@echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–±–æ—Ä–∫–∏..."
	npx next start


# ==============================================================================
# TESTING & QUALITY
# ==============================================================================

# test - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã.
test: install
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	npx vitest run

# lint - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∏–ª—å –∫–æ–¥–∞.
lint: install
	@echo "üé® –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞..."
	npx eslint .

# lint-fix - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ —Å—Ç–∏–ª—è.
lint-fix: install
	@echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å—Ç–∏–ª—è..."
	npx eslint . --fix

# type-check - –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ TypeScript.
type-check: install
	@echo "üßê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript..."
	npx tsc --noEmit

# check-all - –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: –ª–∏–Ω—Ç–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤, —Ç–µ—Å—Ç—ã, —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–±–æ—Ä–∫—É Storybook.
check-all: lint type-check test build build-storybook
	@echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"


# ==============================================================================
# STORYBOOK
# ==============================================================================

# storybook - –∑–∞–ø—É—Å–∫–∞–µ—Ç Storybook.
storybook: install
	@echo "üé® –ó–∞–ø—É—Å–∫ Storybook..."
	npx storybook dev -p 6006

# build-storybook - —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –≤–µ—Ä—Å–∏—é Storybook.
build-storybook: install
	@echo "üìö –°–±–æ—Ä–∫–∞ Storybook..."
	npx storybook build


# ==============================================================================
# EXTERNAL TOOLS
# ==============================================================================

# reinstall-gemini-cli - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫—É @google/gemini-cli.
# –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –æ—à–∏–±–∫–æ–π ENOTEMPTY, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞
# –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞–∫–µ—Ç–∞.
.PHONY: reinstall-gemini-cli
reinstall-gemini-cli:
	@echo "üî• –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ @google/gemini-cli..."
	@echo "1/3: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ npm..."
	npm cache clean --force
	@echo "2/3: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–∞–∫–µ—Ç–∞..."
	rm -rf $$(npm root -g)/@google/gemini-cli
	@echo "3/3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏..."
	npm install -g @google/gemini-cli@latest
	@echo "‚úÖ @google/gemini-cli —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."

