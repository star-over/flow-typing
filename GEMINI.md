# Обзор проекта

Это приложение Next.js для тренировки слепой печати **FlowTyping**.

**Философия проекта:** `FlowTyping` основан на идее **"рефлексивно-адаптивного обучения"**. Вместо скучного заучивания расположения клавиш, в основе лежит формирование мышечной памяти и рефлексов. Обучение происходит через практику на реальных словах и предложениях, а не на бессмысленных наборах символов.

Ключевой инновацией является **отказ от традиционной виртуальной клавиатуры** в пользу **"визуализации движения"** — уникального интерфейса, который подсказывает направление движения пальцев, а не их конечное положение.

Приложение создано с использованием TypeScript, React и Tailwind CSS. Оно использует Storybook для разработки компонентов и Vitest для тестирования.

## Ключевые особенности

*   **Визуализация движения:** Вместо виртуальной клавиатуры пользователю показывается путь, который должен проделать палец от исходной позиции до целевой клавиши.
*   **Адаптивное обучение:** Интеллектуальный алгоритм подбирает упражнения, акцентируя внимание на символах и комбинациях, с которыми у пользователя возникают трудности.
*   **Практика на реальном тексте:** С самого начала обучение проходит на осмысленных словах и предложениях, что делает процесс более увлекательным.
*   **Фокус на рефлексах:** Основная цель — создать устойчивую связь "мысль о символе -> движение пальца", минуя сознательное мышление.
*   **Строка потока (`FlowLine`):** Интерактивная строка, визуализирующая `Stream` (поток символов для набора), имитируя движение каретки печатной машинки.

## Долгосрочное видение

Развитие проекта разделено на 4 фазы:
1.  **Фаза 1 (MVP):** Проверка гипотезы об эффективности "визуализации движения" на минимально жизнеспособном продукте.
2.  **Фаза 2 (Product/Market Fit):** Итеративное улучшение продукта на основе обратной связи, добавление геймификации и расширение пользовательской базы.
3.  **Фаза 3 (Монетизация):** Внедрение Freemium и рекламной моделей, выход на B2B-рынок (корпоративные клиенты, образовательные учреждения).
4.  **Фаза 4 (Лидерство):** Становление лидером рынка, создание специализированных версий (для программистов, писателей) и исследование новых технологий (VR/AR, AI).

# Сборка и запуск

## Разработка

Чтобы запустить сервер для разработки, используйте следующую команду:

```bash
npm run dev
```

Это запустит сервер разработки Next.js по адресу `http://localhost:3000`.

## Storybook

Чтобы запустить Storybook, используйте следующую команду:

```bash
npm run storybook
```

Это запустит сервер разработки Storybook по адресу `http://localhost:6006`.

## Сборка

Чтобы собрать приложение для продакшена, используйте следующую команду:

```bash
npm run build
```

Это создаст готовую к продакшену сборку в каталоге `.next`.

## Тестирование

Чтобы запустить тесты, используйте следующую команду:

```bash
npm run test
```

Это запустит тесты с использованием Vitest.

# Соглашения по разработке

## Стиль кода

В проекте используется стандартный стиль кода Next.js с ESLint для линтинга. Конфигурацию можно найти в `eslint.config.mjs`.

## Соглашения по именованию

В проекте принята формализованная система именования типов. Подробные правила описаны в файле [NAMING_CONVENTIONS.md](./NAMING_CONVENTIONS.md).

## Компоненты

Компоненты находятся в каталоге `src/components`. Компоненты пользовательского интерфейса находятся в `src/components/ui`. В проекте используется `class-variance-authority` для создания вариантов компонентов.

## Данные

Данные приложения находятся в каталоге `src/data`. Сюда входят раскладки клавиатуры, зоны пальцев и раскладки символов.

*   **`symbol-layout-en-qwerty.ts`**: Определяет символы для каждой клавиши (`keyCapId`) с учетом модификатора `Shift`. Использует тип `SymbolLayout`. Логика обработки предусматривает фолбэк на не-Shift версию для системных клавиш.
*   **`finger-layout-asdf.ts`**: Сопоставляет каждую клавишу (`keyCapId`) с идентификатором пальца (`fingerId`), ответственного за ее нажатие. Использует тип `FingerLayout`.
*   **`keyboard-layout-ansi.ts`**: Описывает физическую структуру клавиатуры, включая расположение клавиш по рядам, их размеры и базовые визуальные свойства. Использует тип `KeyboardLayout`.


## Типы

Типы TypeScript находятся в каталоге `src/interfaces`.

# Сохранение информации

Если потребуется сохранить информацию - не использовать внутренний механизм сохранения, так как в этом случае данные сохраняются в общий файл, к которому имеют доступ все проекты, и тогда информация из одного проекта перетечет в другой. Для сохранения информации о проекте необходимо целенаправленно модифицировать именно этот файл.

# Требования к взаимодействию с ИИ



## Стиль общения



*   **Строго деловой и нейтральный тон:** Общение ведется в строго деловом ключе, без эмоциональной окраски. **Запрещены** извинения, обещания, личные мнения, чрезмерная вежливость и другие формы эмоциональных выражений.

*   **Обоснованность утверждений:** Избегать безосновательной уверенности в правильности предложенных решений до их фактической проверки. Признавать итеративный характер процесса разработки и возможность необходимости корректировок.



### Проверка и Валидация



*   **Приоритет автоматизированных проверок:** При выполнении задач, связанных с анализом или модификацией кода, необходимо в первую очередь использовать автоматизированные средства проверки (`npm run test`). Этот подход является основным инструментом для выявления синтаксических ошибок, проблем с типами и регрессий, и ему следует отдавать предпочтение перед исключительно визуальным анализом кода.

## Работа с XState v5

В проекте используется **XState v5**. Весь новый код, связанный с машинами состояний, должен соответствовать синтаксису и практикам этой версии. При возникновении проблем с типами или поведением машин в первую очередь следует сверяться с документацией и паттернами XState v5.

### Ключевые практики и отличия от v4

*   **Строгая типизация (`schemas`):**
    *   Для строгого определения типов `context`, `events`, `actions` и `guards` используйте поле `schemas` в `createMachine`. Это значительно улучшает автодополнение и безопасность типов.
    *   Свойство `schema` (из v4) было переименовано в `schemas`.

*   **Обновление контекста (`assign`):**
    *   Действие `assign` теперь должно возвращать *объект* с обновляемыми полями контекста.
    *   Аргументы в функциях действий и гардов теперь передаются в одном объекте: `{ context, event }`.
        ```typescript
        // Правильно (v5)
        actions: {
          addOne: assign({
            count: ({ context }) => context.count + 1
          }),
          setEventData: assign(( { event }) => ({
            data: event.data
          }))
        }
        ```

*   **Условия (Guards):**
    *   Свойство `cond` (из v4) для условных переходов было полностью заменено на `guard`.

*   **Передача данных в машину (`input`):**
    *   Для передачи начальных данных в машину при ее запуске (через `createActor`) используйте опцию `input`. Это предпочтительнее, чем изменять начальный `context` "на лету".

*   **Читаемость и организация:**
    *   Давайте состояниям и событиям осмысленные, полные имена (например, `FETCH_USER_SUCCESS` вместо `SUCCESS`).
    *   Используйте "переходные состояния" (transient states) с `always` переходами для организации сложных последовательностей действий, не усложняя при этом граф состояний.
    *   Для сложной логики разделяйте машину на дочерние акторы (`spawn`), чтобы избежать создания одной гигантской, трудной для понимания машины.
