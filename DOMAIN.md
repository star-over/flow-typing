# Единый Язык (Ubiquitous Language) Проекта

Этот документ определяет ключевые термины, концепции и границы контекстов предметной области (домена) приложения для тренировки слепой печати.

---

## Ключевые доменные сущности

В основе домена лежат девять ключевых сущностей, которые формируют модель клавиатуры и процесса обучения:

1.  **`KeyboardLayout` (Макет клавиатуры):** "Холст". Описывает физическую геометрию клавиатуры: расположение, размер и форму клавиш. Является базовым слоем.
2.  **`SymbolLayout` (Символьный макет):** "Слой краски". Определяет, какой символ (`'a'`, `'!'`) соответствует каждой физической клавише.
3.  **`FingerLayout` (Пальцевый макет):** "Инструкция". Определяет, каким пальцем следует нажимать каждую клавишу для оптимальной техники.
4.  **`VirtualKeyboard` (Виртуальная клавиатура):** "Ожившая картина". Финальная, собранная модель для отображения в UI. Она объединяет все три макета (`Layout`) и обогащается динамическим состоянием (подсветка, цели, результаты ввода), которое видит пользователь.
5.  **`FlowLine` (Строка потока):** "Каретка". Интерактивная строка ввода текста, имитирующая движение каретки печатной машинки. Она визуализирует процесс набора, разделяя текст на уже набранную часть, текущий символ (курсор) и оставшуюся часть.
6.  **`Stream` (Поток символов):** "Упражнение". Это последовательность символов, которую пользователь должен набрать. `Stream` является источником данных для `FlowLine` и основой для оценки прогресса.
7.  **`Attempt` (Попытка):** Запись одного нажатия клавиши пользователем для конкретного символа. Содержит `typedSymbol` (нажатый символ) и `timestamp` (время нажатия).
8.  **`StreamSymbol` (Символ потока):** Расширенное представление символа из `Stream`, включающее `targetSymbol` (целевой символ) и массив `attempts` (историю всех попыток набора этого символа).
9.  **`TypingStream` (Поток набора):** Массив `StreamSymbol[]`, представляющий собой текущее состояние упражнения пользователя, включая все собранные статистики по каждому символу. `FlowLine` использует `TypingStream` для отображения.

---

## 1. Основные доменные понятия

### 1.1. Клавиатура и физическое устройство

- **Макет клавиатуры (`KeyboardLayout`):** Схема расположения, формы и размера физических клавиш (например, ANSI, ISO). Это базовый "холст" клавиатуры.
  - **Реализация:** `src/data/physical-keyboard-ansi.ts`, тип `KeyboardLayout`.

- **Клавиша (KeyCap):** Физическая или виртуальная клавиша.
  - **Реализация:** `src/components/ui/keycap.tsx`.

- **Код клавиши (Key Event Code / `keyCapId`):** Уникальный идентификатор физической клавиши, соответствующий `KeyboardEvent.code` (например, `KeyA`, `ShiftLeft`).
  - **Реализация:** `src/interfaces/key-events-codes.ts`.

### 1.2. Раскладки и символы

- **Символьный макет (`SymbolLayout`):** Логическая схема распределения символов по физическим клавишам (например, QWERTY, Dvorak).
  - **Реализация:** `src/data/symbol-layout.ts`, тип `SymbolLayout`.

- **Легенда клавиши (Key Legend):** Символы, нанесенные на клавишу.
  - **`base`:** Основной символ (нижний регистр).
  - **`shift`:** Символ, вводимый с `Shift`.
  - **`altGr`:** Символ, вводимый с `AltGr` (на некоторых раскладках).
  - **Реализация:** (Является частью `SymbolLayout`).

### 1.3. Руки и пальцы

- **Рука (Hand):** Левая (`LeftHand`) или правая (`RightHand`).
  - **Реализация:** Тип `HandSide` в `src/interfaces/types.ts`.

- **Палец (Finger):** Палец с уникальным кодом (L4-L0, R0-R4).
  - **Реализация:** Тип `Finger` в `src/interfaces/types.ts`.

- **Основание кисти (Hand Base):**
  - **LB (Left Hand Base):** Левое основание кисти.
  - **RB (Right Hand Base):** Правое основание кисти.
  - **Что это такое:** Это зоны ладони, которые являются опорной точкой для позиционирования кисти и "базой" для движения пальцев.

- **Пальцевый макет (`FingerLayout`):** Схема ответственности каждого пальца за определенные физические клавиши.
  - **Реализация:** `src/data/fingers-zones-asdf.ts`, тип `FingerLayout`.

### 1.4. Система обучения

- **Домашний ряд (Home Row Keys):** Ряд клавиш, на котором пальцы располагаются в исходной позиции (ASDF JKL;).
- **Якорные клавиши (Anchor Keys):** Клавиши F и J, имеющие тактильные маркеры для ориентации вслепую.
- **Функциональная группа (Functional Group):** Группы клавиш по назначению (модификаторы, навигационные, символьные).

---

## 2. Состояния и визуальное представление

Ключевые состояния, определяющие внешний вид и поведение `VirtualKey` в интерфейсе.

- **`visibility` (Видимость):** `HIDDEN` (скрыта) / `VISIBLE` (видима).
- **`navigationRole` (Навигационная роль):**
  - `HOME`: Исходная позиция (якорная клавиша).
  - `TARGET`: Текущая цель для нажатия.
  - `PATH`: Клавиша на пути к цели.
  - `IDLE`: Не участвует в навигации.
- **`pressResult` (Результат нажатия):**
  - `NEUTRAL`: Не оценено.
  - `CORRECT`: Правильное нажатие.
  - `INCORRECT`: Ошибочное нажатие.
- **`homeKeyMarker` (Маркер домашнего ряда):**
  - `BAR`: Черточка (F/J).
  - `DOT`: Точка.
  - `NONE`: Без маркера.
- **`isHomeKey` (Клавиша домашнего ряда):**
  - `true`: Клавиша является частью "домашнего ряда".
  - `false` или `undefined`: Клавиша не является частью "домашнего ряда".

**Реализация:** Все эти состояния определены как типы в `src/interfaces/types.ts`.

---

## 3. Контекстные границы (Bounded Contexts)

Стратегическое разделение домена на независимые части.

### 3.1. Контекст "Конфигуратор Клавиатуры" (Keyboard Setup Context)
- **Ответственность:** Все, что связано с определением и сборкой макетов клавиатуры.
- **Понятия:** `KeyboardLayout`, `SymbolLayout`, `FingerLayout`, `KeyCap`.

### 3.2. Контекст "Обучение" (Training Context)
- **Ответственность:** Процесс тренировки, упражнения и оценка прогресса.
- **Понятия:** `Stream`, `TypingStream`, `StreamSymbol`, `Attempt`, `Lesson`, `Exercise`, `TrainingSession`, `Speed`, `Accuracy`.
- **Понятия (Геймификация, из плана):** `Points`, `Levels`, `Achievements`, `Leaderboard`.

### 3.3. Контекст "Визуализация" (Visualization Context)
- **Ответственность:** Отображение клавиатуры, рук, пальцев и обратной связи.
- **Понятия:** `VirtualKeyboard`, `VirtualKey`, `KeyCap States`, `Hand Positioning`, `Animations`, `FlowLine`.

### 3.4. Контекст "Бизнес и Продукт" (Business & Product Context)
- **Ответственность:** Управление пользователями, монетизация и версии продукта.
- **Понятия (из плана):** `UserAccount`, `Subscription`, `FreemiumModel`, `B2BAccount`, `CorporateDashboard`, `SpecializedVersion` (e.g., for Programmers, Writers).

- **`FlowLine` (Строка потока):** Ключевой компонент упражнения, представляющий собой интерактивную строку для ввода текста. Визуально имитирует движение каретки печатной машинки. Он отображает `TypingStream`, используя цветную подсветку для индикации ошибок. Состоит из трех частей:
    - **Пройденная часть (Completed):** Текст, который уже был правильно набран.
    - **Курсор (Cursor):** Указатель на текущий символ, который необходимо набрать.
    - **Ожидающая часть (Pending):** Текст, который еще предстоит набрать.

---

## 4. Доменные сервисы (Domain Services)

Операции в домене, которые не принадлежат конкретной сущности. (Определены как цель для будущей реализации).

- **`StreamGeneratorService`:** Генерирует потоки символов (`Stream`) для упражнений.
- **`FingerPathCalculator`:** Рассчитывает оптимальные траектории движения пальцев.
- **`ErrorAnalyzer`:** Анализирует ошибки и дает рекомендации.

---

## 5. Доменные события (Domain Events)

События, сообщающие о значимых изменениях в домене. (Определены как цель для будущей реализации).

- **`KeyPressEvaluated`:** Нажатие клавиши было оценено (правильно/неправильно).
- **`LessonProgressUpdated`:** Прогресс урока обновлен.
- **`HandPositionCorrected`:** Позиция руки скорректирована.

---

## 6. Важные инварианты (Invariants)

Бизнес-правила, которые всегда должны соблюдаться.

- Каждая `KeyCap` имеет уникальный `keyCapId` в рамках `KeyboardLayout`.
- Якорные клавиши (F/J) всегда имеют тактильные маркеры (`homeKeyMarker: 'BAR'`).
- Каждое состояние клавиши имеет четкий визуальный сигнал.