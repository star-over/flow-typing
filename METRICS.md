# Метрики для анализа и адаптивного обучения

Этот документ описывает ключевые метрики, которые собираются и анализируются в приложении для оценки и направления прогресса пользователя в слепой печати.

## Категория 1: Базовые метрики производительности

Высокоуровневые показатели для общей оценки скорости и качества.

### 1. Символы в минуту (CPM - Characters Per Minute)

-   **Название:** `cpm`
-   **Описание:** Чистое количество символов, набранных за минуту. Это самый точный показатель сырой скорости пользователя.
-   **Формула:** `(Количество набранных символов / Общее время в секундах) * 60`
-   **Пример расчета:**
    -   Пользователь набрал **250** символов.
    -   Затраченное время: **75** секунд.
    -   Расчет: `(250 / 75) * 60 = 200 CPM`
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Фундаментальную скорость набора текста.
    -   **Применение:** Основной показатель для отслеживания долгосрочного роста скорости. Рост CPM напрямую свидетельствует об улучшении навыка.

### 2. Слова в минуту (WPM - Words Per Minute)

-   **Название:** `wpm`
-   **Описание:** Стандартизированная скорость, где "слово" условно принимается за 5 символов, включая пробелы.
-   **Формула:** `CPM / 5`
-   **Пример расчета:**
    -   CPM пользователя равен **200**.
    -   Расчет: `200 / 5 = 40 WPM`
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Общепринятый стандарт скорости печати, удобный для сравнения.
    -   **Применение:** Используется как мотивационный и сравнительный показатель, так как является индустриальным стандартом.

### 3. Точность (Accuracy)

-   **Название:** `accuracy`
-   **Описание:** Процент правильных нажатий от всех совершённых. Так как система требует исправления ошибки перед продолжением, эта метрика показывает, какая доля нажатий была верной с первой попытки.
-   **Формула:** `(Количество пройденных символов / Общее количество нажатий) * 100%`
-   **Пример расчета:**
    -   Пользователь прошел урок из **100** символов.
    -   Для этого ему потребовалось **110** нажатий (включая 10 нажатий Backspace/неверных клавиш).
    -   Расчет: `(100 / 110) * 100% ≈ 90.9%`
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Качество и чистоту набора. Показывает, насколько хорошо пользователь освоил расположение клавиш.
    -   **Применение:** Критически важная метрика. Алгоритм обучения не должен повышать сложность упражнений, пока точность не достигнет целевого высокого значения (например, 98%).

## Категория 2: Метрики качества и "Потока"

Эти метрики анализируют стабильность и уверенность набора.

### 1. Время на исправление ошибки (Error Correction Time)

-   **Название:** `errorCorrectionTime`
-   **Описание:** Среднее время, которое требуется пользователю, чтобы осознать и исправить ошибку.
-   **Формула:** `Среднее(Timestamp(корректное нажатие) - Timestamp(ошибочное нажатие))` для каждой ошибки.
-   **Пример расчета:**
    -   Ошибка совершена в `10:00:01.500`.
    -   Верная клавиша нажата в `10:00:02.100`.
    -   Время на исправление: `600мс`. Это время усредняется по всем ошибкам в уроке.
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Насколько быстро пользователь реагирует на ошибку и насколько уверенно владеет навигацией (Backspace).
    -   **Применение:** Длительное время исправления может указывать на неуверенность. Алгоритм может предлагать уроки на осознанность и работу над ошибками.

### 2. Стабильность ритма (Rhythm Score)

-   **Название:** `rhythmScore`
-   **Описание:** Стандартное отклонение времени между последовательными нажатиями клавиш. **Ключевая метрика "состояния потока"**.
-   **Формула:** `StandardDeviation(Timestamp(N) - Timestamp(N-1), Timestamp(N-1) - Timestamp(N-2), ...)`
-   **Пример расчета:**
    -   Интервалы между нажатиями (в мс): `[120, 130, 115, 450, 125]`.
    -   Большой выброс `450мс` на фоне стабильных `~120мс` приведет к высокому значению стандартного отклонения.
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Насколько плавно и автоматизированно печатает пользователь. Низкое значение = стабильный ритм (хорошо). Высокое значение = "спотыкания", поиск клавиш, неуверенность.
    -   **Применение:** Цель обучения — минимизировать этот показатель. Если он высокий, алгоритм должен находить проблемные сочетания, вызывающие паузы, и фокусироваться на них.

## Категория 3: Глубокие диагностические метрики

Это ядро для интеллектуального адаптивного алгоритма.

### 1. Матрица ошибок (Confusion Matrix)

-   **Название:** `confusionMatrix`
-   **Описание:** Структура данных (таблица), которая показывает, какие клавиши пользователь нажимает по ошибке вместо целевых.
-   **Формула:** Подсчет `COUNT(*)` для каждой пары `(целевой символ, ошибочный символ)`.
-   **Пример:**
| | a | s | d | f |
| :--- | :-: | :-: | :-: | :-: |
| **цель s** | 4 | - | 12| 1 |
| **цель d** | 0 | 15| - | 2 |
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Систематические ошибки и "слепые зоны". В примере пользователь постоянно путает `s` и `d`.
    -   **Применение:** Мощнейший инструмент для генерации упражнений. Обнаружив такую пару, система создает уроки со словами, где эти буквы часто чередуются (`sad`, `adds`, `database`), чтобы натренировать рефлекторное различие.

### 2. Производительность по пальцам, клавишам, рукам (Per-Finger/Key/Hand Performance)

-   **Название:** `perFingerStats`, `perKeyStats`, `perHandStats`
-   **Описание:** Агрегированные метрики (среднее время нажатия, процент ошибок) для каждого пальца, клавиши или руки.
-   **Формула:** `GROUP BY (fingerId | keyId | handId)`
-   **Пример:**
    -   `Левый мизинец`: 10 ошибок из 50 нажатий (20% ошибок).
    -   `Правый указательный`: 5 ошибок из 200 нажатий (2.5% ошибок).
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Конкретные слабые зоны в моторике пользователя.
    -   **Применение:** Если левый мизинец слаб, алгоритм генерирует тексты с упором на его зону ответственности (`q`, `a`, `z` для QWERTY).

### 3. Сложность N-грамм (N-gram Performance)

-   **Название:** `nGramStats`
-   **Описание:** Анализ скорости и точности для частотных сочетаний из 2 (биграммы) или 3 (триграммы) символов.
-   **Формула:** `GROUP BY (concat(symbol[N-1], symbol[N]))`
-   **Пример:**
    -   Биграмма `my`: среднее время = 350мс, % ошибок = 15%.
    -   Биграмма `th`: среднее время = 180мс, % ошибок = 4%.
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Проблемные *движения* и *переходы* между пальцами, а не просто отдельные клавиши.
    -   **Применение:** Позволяет создавать упражнения, целенаправленно тренирующие сложные для пользователя связки, доводя их до автоматизма и "сглаживая" ритм.

## Категория 4: Агрегированные (Мета) Метрики

Эти метрики объединяют базовые показатели для принятия решений на более высоком уровне.

### 1. Показатель Производительности (Performance Score)

-   **Название:** `performanceScore`
-   **Описание:** Интегральная оценка, отражающая текущее состояние ("в потоке", "скука", "фрустрация") пользователя в реальном времени. Рассчитывается на коротком временном отрезке (например, последние 5-10 слов).
-   **Концептуальная формула:** `PS = (w_acc * Accuracy) + (w_rhythm / RhythmScore) + (w_cpm * CPM_normalized)`
    -   `w_acc`, `w_rhythm`, `w_cpm` — весовые коэффициенты, которые определяют вклад каждой базовой метрики. `Accuracy` (точность) и `RhythmScore` (стабильность ритма) должны иметь наибольший вес.
-   **Что отражает и как применять для обучения:**
    -   **Отражает:** Качество и эффективность набора в данный момент.
    -   **Применение:** Это главный "сигнал" для системы `Dynamic Flow`. На основе значения `Performance Score` система принимает решение о повышении, понижении или сохранении текущего уровня сложности упражнений, удерживая пользователя в оптимальной "зоне потока".

---

**Для получения подробной информации о том, как эти метрики используются для автоматического управления сложностью уроков, обратитесь к документу [DYNAMIC_FLOW_SYSTEM.md](./DYNAMIC_FLOW_SYSTEM.md).**
